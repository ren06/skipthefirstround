extends layout

block content

    script(src='/cloudinary/jquery.ui.widget.js')
    script(src='/cloudinary/jquery.iframe-transport.js')
    script(src='/cloudinary/jquery.fileupload.js')
    script(src='/cloudinary/jquery.cloudinary.js')

    script.

        $(document).ready(function () {

            $('.progress').hide();

            //help from http://code.tutsplus.com/tutorials/smarter-video-handling-with-cloudinary--cms-24416
            var public_id   = '';

            $('#cvFile').unsigned_cloudinary_upload("curriculum",
                    {cloud_name: 'dzfmkzqdo', tags: 'browser_uploads'},
                {multiple: false}, function(err){
                        alert(err);
                    }
                //http://cloudinary.com/documentation/upload_videos#upload_parameters_reference
            ).bind('fileuploadstart', function(e, data){

                    $('.progress').show();
                    $('.progress-bar').removeClass('progress-bar-danger');
                    $('.progress-bar').removeClass('notransition');
                    $('#progressText').html('');
                    $('.progress-bar').css('width', '0%').attr('aria-valuenow', 0);


            }
            ).bind('cloudinarydone', function (e, data) {

                public_id = data.result.public_id;

                $('#progressText').html(data.result.original_filename + '.pdf');
                $('#cvUniqueId').val(public_id);
                $('.progress-bar').addClass('progress-bar-success');

            }
            ).bind('cloudinaryprogress', function (e, data) {

                $('.progress-bar').css('width', Math.round((data.loaded * 100.0) / data.total) + '%');
            }
            )
            .bind('fileuploadfail', function(e, data){

                var errorMessage = data.jqXHR.responseJSON.error.message;

                $('#progressText').html(errorMessage);
                $('.progress-bar').addClass('progress-bar-danger');
                $(".progress-bar").addClass('notransition');

            });
        });

    .col-lg-2.text-center
    .col-lg-8
        if(!session.authenticated)
            h2 Enregistrement
        else
            h2 Demande d'entretien pour offre
        br
        h4 Offer ##{offer.id} #{offer.sectorText} - #{offer.offerTypeText} - #{offer.location}
        br
        form.form-horizontal(id="registerForm", action="", method="post", role="form")
            if(error)
                .alert.alert-danger(role="alert") #{error}

            input(type='hidden' name='offerId' value="#{offer.id}")
            input(type='hidden' name='sector' value="#{offer.sector}")

            .form-group
                label.control-label.col-sm-4(for='cvFile') Votre CV:
                .col-sm-3
                    label.btn.btn-default.btn-file(style='width:160px')
                        |   Select CV file...
                        input#cvFile(type="file" style="display: none;" name="file")
                .col-sm-5.vertical-center
                    div.progress
                        div.progress-bar.progress-bar-striped(role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="text-align:center")
                            span#progressText
                .col-sm-2
                    div.file-title
                input(id="cvUniqueId" type="hidden" name="cv" value="#{formData.cv}")
                if(formData.cv !== '')
                    a(href='#{cvLink}') See current CV

            if(!session.authenticated)

                .form-group.required
                    label.control-label.col-sm-4(for='firstName') Prenom:
                    .col-sm-8
                        input#firstName(type="", name="firstName", placeholder="" value="#{formData.firstName}").form-control

                .form-group.required
                    label.control-label.col-sm-4(for='lastName') Nom:
                    .col-sm-8
                        input#lastName(type="", name="lastName", placeholder="" value="#{formData.lastName}").form-control

            .form-group.required
                label.control-label.col-sm-4(for='skypeId') Votre identifiant Skype:
                .col-sm-8.required
                    input#skypeId(type="", name="skypeId", placeholder="Pour realiser l'interview" value="#{formData.skypeId}").form-control

            .form-group.required
                label.control-label.col-sm-4(for='availability') Vos disponibilites:
                .col-sm-8
                    input#availability(type="", name="availability", placeholder="Ex. tous les soirs a partir de 19h" value="#{formData.availability}").form-control

            .form-group
                label.control-label.col-sm-4(for='mobilePhone') Telephone portable:
                .col-sm-8
                    input#mobilePhone(type="", name="mobilePhone", placeholder="" value="#{formData.mobilePhone}").form-control

            if(!session.authenticated)

                .form-group.required
                    label.control-label.col-sm-4(for='email') Email:
                    .col-sm-8
                        input#email(type="email", name="email", placeholder="Email" value="#{formData.email}").form-control

                .form-group.required
                    label.control-label.col-sm-4(for='password') Mot de passe:
                    .col-sm-8
                        input#password(type="password", name="password", placeholder="Mot de passe", value="#{formData.password}").form-control

                .form-group.required
                    label.control-label.col-sm-4(for='confirmationPassword') Confirmation mot de passe:
                    .col-sm-8
                        input#confirmationPassword(type="password", name="confirmationPassword", placeholder="Confirmation mot de passe", value="#{formData.confirmationPassword}").form-control

            .form-group
                .col-sm-offset-4.col-sm-10
                    //button(type="submit").btn.btn-default S'enregister
                    button.btn.btn-default(type="submit") S'enregistrer

    .col-lg-2.text-center
